<?xml version="1.0" encoding="US-ASCII"?>
<!-- This template is for creating an Internet Draft using xml2rfc,
     which is available here: http://xml.resource.org. -->
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!-- One method to get references from the online citation libraries.
     There has to be one entity for each item to be referenced.
     An alternate method (rfc include) is described in the references. -->
<!ENTITY RFC2119 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC6241 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6241.xml">
<!ENTITY RFC7950 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.7950.xml">
<!ENTITY RFC7149 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.7149.xml">
<!ENTITY RFC7426 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.7426.xml">
<!ENTITY RFC8299 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.8299.xml">
<!ENTITY RFC8309 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.8309.xml">
<!ENTITY RFC8340 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.8340.xml">
<!ENTITY RFC8453 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.8453.xml">
<!ENTITY RFC8174 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.8174.xml">
<!ENTITY RFC8345 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.8345.xml">
]>
<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>
<!-- used by XSLT processors -->
<!-- For a complete list and description of processing instructions (PIs),
     please see http://xml.resource.org/authoring/README.html. -->
<!-- Below are generally applicable Processing Instructions (PIs) that most I-Ds might want to use.
     (Here they are set differently than their defaults in xml2rfc v1.32) -->
<?rfc strict="yes" ?>
<!-- give errors regarding ID-nits and DTD validation -->
<!-- control the table of contents (ToC) -->
<?rfc toc="yes"?>
<!-- generate a ToC -->
<?rfc tocdepth="4"?>
<!-- the number of levels of subsections in ToC. default: 3 -->
<!-- control references -->
<?rfc symrefs="yes"?>
<!-- use symbolic references tags, i.e, [RFC2119] instead of [1] -->
<?rfc sortrefs="yes" ?>
<!-- sort the reference entries alphabetically -->
<!-- control vertical white space
     (using these PIs as follows is recommended by the RFC Editor) -->
<?rfc compact="yes" ?>
<!-- do not start each main section on a new page -->
<?rfc subcompact="no" ?>
<!-- keep one blank line between list items -->
<!-- end of list of popular I-D processing instructions -->
<rfc category="std" docName="draft-ietf-opsawg-sap-latest" ipr="trust200902">
  <front>
    <title abbrev="SAP Network YANG">A Network YANG Model for Service
    Attachment Points (SAPs)</title>

    <author fullname="Oscar Gonzalez de Dios" initials="O"
            surname="Gonzalez de Dios">
      <organization>Telefonica</organization>

      <address>
        <postal>
          <street></street>

          <city>Madrid</city>

          <region></region>

          <code></code>

          <country>Spain</country>
        </postal>

        <phone></phone>

        <email>oscar.gonzalezdedios@telefonica.com</email>
      </address>
    </author>

    <author fullname="Samier Barguil" initials="S." surname="Barguil">
      <organization>Telefonica</organization>

      <address>
        <postal>
          <street></street>

          <city>Madrid</city>

          <region></region>

          <code></code>

          <country>Spain</country>
        </postal>

        <phone></phone>

        <facsimile></facsimile>

        <email>samier.barguilgiraldo.ext@telefonica.com</email>

        <uri></uri>
      </address>
    </author>

    <author fullname="Qin Wu" initials="Q." surname="Wu">
      <organization>Huawei</organization>

      <address>
        <postal>
          <street>101 Software Avenue, Yuhua District</street>

          <city>Nanjing</city>

          <region>Jiangsu</region>

          <code>210012</code>

          <country>China</country>
        </postal>

        <email>bill.wu@huawei.com</email>
      </address>
    </author>

    <author fullname="Mohamed Boucadair" initials="M." surname="Boucadair">
      <organization>Orange</organization>

      <address>
        <postal>
          <street></street>

          <city></city>

          <region></region>

          <code></code>

          <country>France</country>
        </postal>

        <phone></phone>

        <email>mohamed.boucadair@orange.com</email>
      </address>
    </author>

    <author fullname="Victor Lopez" initials="V." surname="Lopez">
      <organization>Nokia</organization>

      <address>
        <postal>
          <street></street>

          <city></city>

          <region></region>

          <code></code>

          <country>Spain</country>
        </postal>

        <phone></phone>

        <facsimile></facsimile>

        <email>victor.lopez@nokia.com</email>

        <uri></uri>
      </address>
    </author>

    <date year="2022" />

    <area>ops</area>

    <workgroup>OPSAWG</workgroup>

    <keyword>SAP Network YANG</keyword>

    <abstract>
      <t>This document defines a YANG data model for representing an abstract
      view of the provider network topology containing the points from which
      its services can be attached (e.g., basic connectivity, VPN, network
      slices). The data model augments the 'ietf-network' data model by adding
      the concept of Service Attachment Points (SAPs). The Service Attachment
      Points are the points to which network services (such as Layer 3 Virtual
      Private Network (L3VPN) or Layer 2 Virtual Private Network (L2VPN)) can
      be attached.</t>
    </abstract>
  </front>

  <middle>
    <section anchor="Introduction" title="Introduction">
      <t>The Service Attachment Point (SAP) is an important architectural
      concept in many implementations and deployments of services such as
      Virtual Private Networks (VPNs), Software-Defined Wide Area Network
      (SDWAN), or managed Voice over IP (VoIP) services. It is used to decide
      where to attach and, thus, deliver the service in the Layer 3 VPN
      Service Model (L3SM) <xref target="RFC8299"></xref> and the Layer 2 VPN
      Service Model (L2SM) <xref target="RFC8466"></xref>. It can also be used
      to retrieve where services, such as the Layer 3 VPN Network Model (L3NM)
      <xref target="I-D.ietf-opsawg-l3sm-l3nm"></xref>, and the Layer 2 VPN
      Network Model (L2NM) <xref target="I-D.ietf-opsawg-l2nm"></xref>, are
      delivered.</t>

      <t>This document defines a YANG network model for representing,
      managing, and controlling the Service Attachment Points. The data model
      augments the 'ietf-network' module <xref target="RFC8345"></xref> by
      adding the concept of Service Attachment Points. The Service Attachment
      Points are abstraction of the points where network services can be
      attached.</t>

      <t>This document does not make any assumption about the service(s)
      provided by the network to the users. VPN services (such as Layer 3
      Virtual Private Network (L3VPN) or Layer 2 Virtual Private Network
      (L2VPN)) are used for illustration purposes. The SAP concept can be used
      to decide network slice SAPs <xref
      target="I-D.ietf-teas-ietf-network-slices"></xref>.</t>

      <t>In the context of Software-Defined Networking (SDN) <xref
      target="RFC7149"></xref><xref target="RFC7426"></xref>, the defined YANG
      data model in this document can be used to exchange information between
      control elements, so as to support VPN service provision and resource
      management discussed in <xref
      target="I-D.ietf-opsawg-l3sm-l3nm"></xref><xref
      target="I-D.ietf-opsawg-l2nm"></xref>. Through this data model, the
      service orchestration layer can learn the available endpoints (i.e.,
      SAPs) of interconnection resources of the underlying network. The
      service orchestration layer can determine which interconnection
      endpoints to add to an L2VPN or L3VPN service. With the help of other
      data models (e.g., L3SM <xref target="RFC8299"></xref> or L2SM <xref
      target="RFC8466"></xref>), hierarchical control elements can also assess
      the feasibility of an end-to-end IP connectivity or L2VPN connectivity
      and, therefore, derive the sequence of domains and the points of
      interconnection to use.</t>

      <t>This document explains the scope and purpose of a SAP network model
      and its relation with the service models.</t>

      <t>The YANG data model in this document conforms to the Network
      Management Datastore Architecture (NMDA) <xref
      target="RFC8342"></xref>.</t>
    </section>

    <section anchor="terminology" title="Terminology">
      <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
      "OPTIONAL" in this document are to be interpreted as described in BCP 14
      <xref target="RFC2119"></xref><xref target="RFC8174"></xref> when, and
      only when, they appear in all capitals, as shown here.</t>

      <t>This document assumes that the reader is familiar with the contents
      of <xref target="RFC6241"></xref>, <xref target="RFC7950"></xref>, and
      <xref target="RFC8309"></xref>. The document uses terms from those
      documents.</t>

      <t>The meanings of the symbols in tree diagrams are defined in <xref
      target="RFC8340"></xref>.</t>

      <t>This document uses the term "network model" defined in Section 2.1 of
      <xref target="RFC8969"></xref>.</t>

      <t>This document uses the following terms:<list style="hanging">
          <t hangText="Service povider (SP): ">The organization responsible
          for operating the network that offers a service (e.g., a VPN) to
          customers.</t>

          <t hangText="Customer Edge (CE): ">An equipment that is dedicated to
          a particular customer and is directly connected to one or more
          Provider Edges (PEs) via attachment circuits (ACs). A CE is usually
          located at the customer premises. A CE may be dedicated to a single
          service (e.g., L3VPN), although it may support multiple VPNs if each
          one has separate attachment circuits. A CE can be a router, bridge,
          switch, etc.</t>

          <t hangText="Provider Edge (PE): ">An equipment owned and managed by
          the SP that can support multiple services (e.g., VPNs) for different
          customers. A PE is directly connected to one or more CEs via
          attachment circuits.</t>

          <t hangText="Attachment point (AP):  ">Describes a service's
          endpoint characteristics and its reference to a Termination Point
          (TP) of the PE; used as service access point for service.</t>
        </list></t>
    </section>

    <section title="SAP Network Model Usage">
      <t>Management operations of a service provider network can be automated
      using a variety of means such as interfaces based on YANG modules <xref
      target="RFC8969"></xref>. From that standpoint, and considering the
      architecture depicted in <xref target="fi1"></xref>, a goal of this
      document is to provide a mechanism to show via a YANG-based interface an
      abstracted network view from the network controller to the service
      orchestration layer with a focus on where a service can be (or is)
      delivered to customers.</t>

      <figure align="center" anchor="fi1" title="SAP Network Model Usage">
        <artwork align="left"><![CDATA[                            +-----------------+
                            |     Customer    |
                            +--------+--------+
            Customer Service Models  |
               (e.g., L3SM, L2SM)    |
                            +--------+--------+
                            |    Service      |
                            |  Orchestration  |
                            +------+---+------+
                Network Models     |   | SAP Network Model
              (e.g., L3NM, L2NM)   |   |
                            +------+---+------+
                            |     Network     |
                            |   Controller    |
                            +--------+--------+
                                     |
               +---------------------+---------------------+
               |                  Network                  |
               +-------------------------------------------+
]]></artwork>
      </figure>

      <t>Let us consider the example of a typical service provider network
      (<xref target="fi2"></xref>), with PE and P nodes.</t>

      <t><figure align="center" anchor="fi2" title="Sample Network Topology">
          <artwork align="center"><![CDATA[+---------+         +---------+
|   PE1   |         |   PE2   |
+---------+         +---------+
           \       /
           +------+
           |  P   |
           +------+
          /        \
+---------+         +---------+
|   PE3   |         |   PE4   |
+---------+         +---------+]]></artwork>
        </figure></t>

      <t>The Service orchestration layer does not need to know about the
      internals of the underlying network (e.g., P nodes). <xref
      target="fi2a"></xref> shows the abstract network view as seen by the
      Service Orchestrator. However, this view is not enough to provide to the
      Service Orchestration layer the information to create services in the
      network. The service topology need is to be able to expose the set of
      nodes and the attachment points associated with the nodes from which
      network services can be grafted (delivered).</t>

      <t><figure align="center" anchor="fi2a"
          title="Abstract Network Topology">
          <artwork align="center"><![CDATA[+---------+         +---------+
|   PE1   |         |   PE2   |
+---------+         +---------+
                                         

+---------+         +---------+
|   PE3   |         |   PE4   |
+---------+         +---------+]]></artwork>
        </figure></t>

      <t>The Service Orchestration layer would see a set of PEs and a set of
      client-facing interfaces (physical or logical) to which CEs can be
      connected (or are actually connected). The Service Orchestration layer
      can use them to setup the requested services or to commit the delivery
      of a service. <xref target="fi3"></xref> depicts the SAP network
      topology that is maintained by the network controller and exposed to the
      Service Orchestration.</t>

      <figure align="center" anchor="fi3" title="SAP Network Topology">
        <artwork align="center"><![CDATA[           .---. .---. .---.              .---.       .---.   
         +-|sap|-|sap|-|sap|-+          +-|sap|-------|sap|-+  
         | '---' '---' '---' |          | '---'       '---' |
       .---.                 |          |                   |
       |sap|      PE1        |          |         PE2       |
       '---'                 |          |                   |
         |                   |          |                   |
         +-------------------+          +-------------------+
                                                   
                                                   
         +-------------------+          +-------------------+
         |                   |          |                   |
         |                   |          |                 .---.
         |         PE3       |          |        PE4      |sap|
         |                   |          |                 '---'
         | .---. .---. .---. |          | .---. .---. .---. |  
         +-|sap|-|sap|-|sap|-+          +-|sap|-|sap|-|sap|-+  
           '---' '---' '---'              '---' '---' '---'      
]]></artwork>
      </figure>

      <t>A single SAP network topology can be used for one of multiple service
      types (e.g., L3VPN, Ethernet VPN (EVPN)). The network controller can
      then expose the service type(s) and associated interfaces via the
      SAPs.</t>

      <t>As shown in <xref target="fi3a"></xref>, the Service Orchestration
      layer will have also access to a set of Customer Service Model, e.g., an
      L3SM or L2SM data model in the customer-facing interface and a set of
      network models, e.g., the L3NM and Network topology data models in the
      resource-facing interface. In this use case, it is assumed that the
      network controller is unaware of what happens beyond the PEs towards the
      CEs; it is only responsible for the management and control of the
      network between PEs.</t>

      <t><figure align="center" anchor="fi3a"
          title="Network Topology with CEs and ACs">
          <artwork align="center"><![CDATA[                                                      .---.
                                                      |CE2|
                                                      '-+-'
                                                        | 
           .---. .---. .---.              .---.       .-+-.   
         +-|sap|-|sap|-|sap|-+          +-|sap|-------|sap|-+  
         | '---' '---' '---' |          | '---'       '---' |
.---.  .---.                 |          |                   |
|CE1+--+sap|      PE1        |          |         PE2       |
'---'  '---'                 |          |                   |
         |                   |          |                   |
         +-------------------+          +-------------------+
                                                   
                                                   
         +-------------------+          +-------------------+
         |                   |          |                   |
         |                   |          |                 .---.  .---.
         |         PE3       |          |        PE4      |sap+--+CE5|
         |                   |          |                 '---'  '---'
         | .---. .---. .---. |          | .---. .---. .---. |  
         +-|sap|-|sap|-|sap|-+          +-|sap|-|sap|-|sap|-+  
           '---' '---' '-+-'              '---' '---' '---'   
                         |                        | 
                       .-+-.                    .-+-.
                       |CE3|                    |CE4|
                       '-+-'                    '-+-'   
]]></artwork>
        </figure></t>

      <t></t>
    </section>

    <section title="SAP Module Tree Structure">
      <t>The SAP network model builds on the network data model defined in the
      'ietf-network' module <xref target="RFC8345"></xref>, augmenting the
      nodes with Service Attachment Points, which anchor the links and are
      contained in nodes. The 'service-attachment-point' attribute defined in
      the SAP network model is not a tunnel termination point (TTP) nor a
      link, but an abstraction of the termination point defined in <xref
      target="RFC8345"></xref>.</t>

      <t>The structure of the 'ietf-sap-ntw' module is shown in <xref
      target="fi4"></xref>.</t>

      <figure anchor="fi4" title="YANG Module Structure">
        <artwork><![CDATA[module: ietf-sap-ntw
  augment /nw:networks/nw:network/nw:network-types:
    +--rw sap-network!
       +--rw sap-type*   identityref
  augment /nw:networks/nw:network/nw:node:
    +--rw service* [sap-type]
       +--rw sap-type                    identityref
       +--rw service-attachment-point* [attachment-id]
          +--rw attachment-id               nt:tp-id
          +--rw parent-termination-point?   nt:tp-id
          +--rw interface-type?             identityref
          +--rw encapsulation-type?         identityref
          +--rw interface-role?             identityref
          +--rw description?                string
          +--rw status
          |  +--rw admin-status
          |  |  +--rw status?        identityref
          |  |  +--rw last-change?   yang:date-and-time
          |  +--ro oper-status
          |     +--ro status?        identityref
          |     +--ro last-change?   yang:date-and-time
          +--ro service-status
          |  +--ro status?        identityref
          |  +--ro last-change?   yang:date-and-time
          +--rw peer-customer-sap-id?       string]]></artwork>
      </figure>

      <t>A SAP network topology can be used for one single service type or
      multiple types ("sap-type"). When a SAP topology is used for many
      service types, the underlying nodes must support at least one of these
      service types. Examples of supported service types are listed below:
      <list style="symbols">
          <t>L3VPN,</t>

          <t>Virtual Private LAN Service (VPLS) using BGP <xref
          target="RFC4761"></xref>,</t>

          <t><xref target="RFC4762">VPLS using Label Distribution Protocol
          (LDP)</xref>,</t>

          <t><xref target="RFC8214">Virtual Private Wire Service
          (VPWS)</xref>,</t>

          <t><xref target="RFC7432">BGP MPLS-Based Ethernet VPN</xref>,</t>

          <t><xref target="RFC8365">Ethernet VPN (EVPN)</xref>,</t>

          <t><xref target="RFC7623">Provider Backbone Bridging Combined with
          Ethernet VPN (PBB-EVPN)</xref>,</t>

          <t>Virtual Networks <xref target="RFC8453"></xref>,</t>

          <t>Enhanced VPN (VPN+) <xref
          target="I-D.ietf-teas-enhanced-vpn"></xref>, and</t>

          <t>Network slice <xref
          target="I-D.ietf-teas-ietf-network-slices"></xref>.</t>
        </list></t>

      <t>A Service Attachment Point is identified by an interface name
      ("attachment-id"), an interface type ("type"), a status ("admin-status"
      and "oper-status"), an encapsulation type ("encapsulation-type"), one or
      a list of service types ("sap-type"), a description of the service(s)
      ("service-description").</t>

      <t>"attachment-id" may include a reference to a physical or a logical
      interface. For example, an "attachment-id" may be the interface
      identifier of a VPN network access used in Section 7.6 of <xref
      target="I-D.ietf-opsawg-l3sm-l3nm"></xref>.</t>
    </section>

    <section title="Relationship to Other YANG Data Models">
      <t>The SAP network model can be seen as an inventory data associated
      with SAPs. The model maintains an inventory of nodes contained in a
      network based on <xref target="RFC8345"></xref>.</t>

      <figure anchor="fig5"
              title="Relation of SAP Network Model to Other Models">
        <artwork><![CDATA[                +-------------------------+
                |                         |
                |  Abstract Network Model |
                |                         |
                +------------+------------+
                             |
                   +---------+---------+
                   |                   |
            +------V------+     +------V------+
            |  Abstract   |     |  Inventory  |
            |  Network    |     |   Model(s)  |
            |  Topology   |     |   e.g.,SAP  |
            |   Model     |     |   Network   |
            |             |     |    Model    |
            +-----+-------+     +-------------+
                  |
      +-----------+-----------+
      |           |           |
 +----V----+ +----V----+ +----V----+
 |TE Topo  | |L3 Topo  | |L2 Topo  |
 |  Model  | |  Model  | |  Model  | ...
 +---------+ +---------+ +---------+]]></artwork>
      </figure>

      <t><xref target="fig5"></xref> depicts the relationship of the SAP
      network model to other models. The SAP network model augments from the
      Network model <xref target="RFC8345"></xref> and imports Network
      Topology model, while other technology-specific topology models (e.g.,
      TE Topologies model <xref target="RFC8795"></xref> or L3 Topology model
      <xref target="RFC8346"></xref>) augment from the Network Topology.</t>
    </section>

    <section title="SAP YANG Module">
      <t>This module imports types from <xref target="RFC8343"></xref>, <xref
      target="RFC8345"></xref>, and <xref
      target="I-D.ietf-opsawg-vpn-common"></xref>.</t>

      <figure>
        <artwork><![CDATA[<CODE BEGINS>  file "ietf-sap-ntw@2022-02-07.yang"
module ietf-sap-ntw {
  yang-version 1.1;
  namespace "urn:ietf:params:xml:ns:yang:ietf-sap-ntw";
  prefix sap;

  import ietf-network-topology {
    prefix nt;
    reference
      "RFC 8345: A YANG Data Model for Network
                 Topologies, Section 6.2";
  }
  import ietf-network {
    prefix nw;
    reference
      "RFC 8345: A YANG Data Model for Network
                 Topologies, Section 6.1";
  }
  import ietf-vpn-common {
    prefix vpn-common;
    reference
      "RFC 9181: A Common YANG Data Model for Layer 2 and Layer 3
                 VPNs";
  }

  organization
    "IETF OPSA (Operations and Management Area) Working Group ";
  contact
    "WG Web:   <https://datatracker.ietf.org/wg/opsawg/>
     WG List:  <mailto:opsawg@ietf.org>

     Author:   Oscar Gonzalez de Dios
               <mailto:oscar.gonzalezdedios@telefonica.com>

     Author:   Samier Barguil
               <mailto:samier.barguilgiraldo.ext@telefonica.com>

     Author:   Qin Wu
               <mailto:bill.wu@huawei.com>

     Editor:   Mohamed Boucadair
               <mailto:mohamed.boucadair@orange.com>

     Author:   Victor Lopez
               <victor.lopez@nokia.com>";
  description
    "This YANG module defines a model for representing, managing,
     and controlling the Service Attachment Points (SAPs) in the
     network topology.

     Copyright (c) 2022 IETF Trust and the persons identified as
     authors of the code.  All rights reserved.

     Redistribution and use in source and binary forms, with or
     without modification, is permitted pursuant to, and subject to
     the license terms contained in, the Simplified BSD License set
     forth in Section 4.c of the IETF Trust's Legal Provisions
     Relating to IETF Documents
     (https://trustee.ietf.org/license-info).

     This version of this YANG module is part of RFC XXXX
     (https://www.rfc-editor.org/info/rfcXXXX); see the RFC itself
     for full legal notices.";

  revision 2022-02-07 {
    description
      "Initial version";
    reference
      "RFC XXXX: A Network YANG Model for Service Attachment
                 Points (SAPs)";
  }

  identity service-type {
    description
      "Base identity for the service type.";
  }

  identity l3vpn {
    base service-type;
    description
      "L3VPN service.";
    reference
      "RFC 4364: BGP/MPLS IP Virtual Private Networks (VPNs)";
  }

  identity enhanced-vpn {
    base service-type;
    description
      "Enhanced VPN (VPN+). VPN+ is an approach that is
       based on existing VPN and Traffic Engineering (TE) 
       technologies but adds characteristics that specific
       services require over and above traditional VPNs.";
    reference
      "I-D.ietf-teas-enhanced-vpn: 
         A Framework for Enhanced Virtual Private Network
         (VPN+) Services";
  }

  identity network-slice {
    base service-type;
    description
      "IETF network slice.  An IETF network slice
       is a logical network topology connecting a number of
       endpoints using a set of shared or dedicated network
       resources that are used to satisfy specific service
       objectives.";
    reference
      "I-D.ietf-teas-ietf-network-slices:
         Framework for IETF Network Slices";
  }

  identity vpls {
    base service-type;
    description
      "Virtual Private LAN Service (VPLS).";
    reference
      "RFC 4761: Virtual Private LAN Service (VPLS) Using BGP for
                 Auto-Discovery and Signaling
       RFC 4762: Virtual Private LAN Service (VPLS) Using Label
                 Distribution Protocol (LDP) Signaling";
  }

  identity vpws {
    base service-type;
    description
      "Virtual Private Wire Service (VPWS).";
    reference
      "RFC 4664: Framework for Layer 2 Virtual Private Networks
                 (L2VPNs), Section 3.1.1";
  }
  
  identity vpws-evpn {
    base service-type;
    description
      "EVPN used to support VPWS.";
    reference
      "RFC 8214: Virtual Private Wire Service Support in Ethernet VPN";
  }

  identity pbb-evpn {
    base service-type;
    description
      "Provider Backbone Bridging (PBB) EVPN service.";
    reference
      "RFC 7623: Provider Backbone Bridging Combined with Ethernet VPN
                 (PBB-EVPN)";
  }

  identity mpls-evpn {
    base service-type;
    description
      "MPLS-based EVPN service.";
    reference
      "RFC 7432: BGP MPLS-Based Ethernet VPN";
  }

  identity vxlan-evpn {
    base service-type;
    description
      "VXLAN-based EVPN service.";
    reference
      "RFC 8365: A Network Virtualization Overlay Solution Using
                 Ethernet VPN (EVPN)";
  }

  identity virtual-network {
    base service-type;
    description
      "Virtual network.";
    reference
      "RFC 8453: Framework for Abstraction and Control of TE
                 Networks (ACTN)";
  }

  identity sdwan {
    base service-type;
    description
      "PE-based Software-Defined Wide Area Network (SDWAN).";
    reference
      "I-D.ietf-bess-bgp-sdwan-usage: BGP Usage for SDWAN 
             Overlay Network";
  }

  identity interface-role {
    description
      "Base identity for the network role of an interface.";
  }

  identity uni {
    base interface-role;
    description
      "User-Network Interface (UNI).";
  }

  identity nni {
    base interface-role;
    description
      "Network-to-Network Interface (NNI).";
  }

  identity interface-type {
    description
      "Base identity for the interface type.";
  }

  identity phy {
    base interface-type;
    description
      "Phyical port.";
  }

  identity loopback {
    base interface-type;
    description
      "Loopback interface.";
  }

  identity lag {
    base interface-type;
    description
      "LAG interface.";
  }

  identity irb {
    base interface-type;
    description
      "Integrated Routing Bridge (IRB).";
  }

  identity local-bridge {
    base interface-type;
    description
      "A local bridge reference to accommodate, e.g., 
       implementations that require internal bridging.
       When such a type is used, a reference to a local
       bridge domain is used to identify the interface.";
  }

  identity logical {
    base interface-type;
    description
      "Refers to a logical sub-intreface that is typically 
       used to bind a service. This type is used only
       if none of the other logical types can be used.";
  }

  grouping sap-information {
    description
      "Service Attachment Point (SAP) information.";
    list service-attachment-point {
      key "attachment-id";
      description
        "The Service Attachment Points are abstraction of
         the points where network services such as L3VPNs,
         L2VPNs, or network slices can be attached to.";
      leaf attachment-id {
        type nt:tp-id;
        description
          "Indicates the identifier of the interface to 
           which the SAP is attached. This interface can 
           be a physical or logical interface.";
      }
      leaf parent-termination-point {
        type nt:tp-id;
        description
          "Indicates the parent termination point to 
           which the SAP is attached to. A termination
           point can be a physical port, an interface, etc.";
      }
      leaf interface-type {
        type identityref {
          base interface-type;
        }
        description
          "The type of the interface.";
      }
      leaf encapsulation-type {
        type identityref {
          base vpn-common:encapsulation-type;
        }
        description
          "Encapsulation type of the interface.";
      }
      leaf interface-role {
        type identityref {
          base interface-role;
        }
        description
          "Indicates whether the SAP is an UNI or a NNI.";
      }
      leaf description {
        type string;
        description
          "A textual description of the SAP.";
      }      
      uses vpn-common:service-status;
      container service-status {
        description
          "Service status.";
        config "false"; 
        uses vpn-common:oper-status-timestamp;
      }
      leaf peer-customer-sap-id {
        type string;
        description
          "Indicates an identifier of the peer's termination
           identifier (e.g., Customer Edge (CE)). This 
           information can be used for correlation purposes, 
           such as identifying the SAP that is attached to 
           an endpoint that is provided in a service request.";
      }
    }
  }

  augment "/nw:networks/nw:network/nw:network-types" {
    description
      "Introduces a new network type for SAP network.";
    container sap-network {
      presence "Indicates SAP Network Type.";
      description
        "The presence of the container node indicates the 
         SAP network type.";
      leaf-list sap-type {
        type identityref {
          base service-type;
        }
        description
          "Indicates the set of supported service types.";
      }
    }
  }

  augment "/nw:networks/nw:network/nw:node" {
    description
      "Parameters for the SAP level.";
    list service {
      key "sap-type";
      description
        "Indicates a list of services.";
      leaf sap-type {
        type identityref {
          base service-type;
        }
        description
          "SAP type.";
      }
      uses sap-information;
   }
  }
}
<CODE ENDS>]]></artwork>
      </figure>
    </section>

    <section anchor="IANA" title="IANA Considerations">
      <t>This document registers the following namespace URI in the "ns"
      subregistry within the "IETF XML Registry" [RFC3688]: <figure>
          <artwork><![CDATA[    URI: urn:ietf:params:xml:ns:yang:ietf-sap-ntw
    Registrant Contact: The IESG.
    XML: N/A, the requested URI is an XML namespace.
]]></artwork>
        </figure></t>

      <t>This document registers the following YANG module in the YANG Module
      Names registry [RFC6020] within the "YANG Parameters" registry: <figure>
          <artwork><![CDATA[    name: ietf-sap-ntw
    namespace: urn:ietf:params:xml:ns:yang:ietf-sap-ntw
    maintained by IANA? N
    prefix: sap
    reference: RFC XXXX
]]></artwork>
        </figure></t>
    </section>

    <section anchor="scecurity" title="Security Considerations">
      <t>The YANG module specified in this document defines schema for data
      that is designed to be accessed via network management protocols such as
      NETCONF <xref target="RFC6241"></xref> or RESTCONF <xref
      target="RFC8040"></xref>. The lowest NETCONF layer is the secure
      transport layer, and the mandatory-to-implement secure transport is
      Secure Shell (SSH) <xref target="RFC6242"></xref>. The lowest RESTCONF
      layer is HTTPS, and the mandatory-to-implement secure transport is TLS
      <xref target="RFC8446"></xref>.</t>

      <t>The Network Configuration Access Control Model (NACM) <xref
      target="RFC8341"></xref> provides the means to restrict access for
      particular NETCONF or RESTCONF users to a preconfigured subset of all
      available NETCONF or RESTCONF protocol operations and content.</t>

      <t>There are a number of data nodes defined in this YANG module that are
      writable/creatable/deletable (i.e., config true, which is the default).
      These data nodes may be considered sensitive or vulnerable in some
      network environments. Write operations (e.g., edit-config) to these data
      nodes without proper protection can have a negative effect on network
      operations. These are the subtrees and data nodes and their
      sensitivity/vulnerability: <list style="symbols">
          <t>/nw:networks/nw:network/nw:node/sap:service-attachment-point/
          sap:attachment-id</t>
        </list></t>

      <t>This subtree specifies the configurations of the nodes in a SAP
      network model. Unexpected changes to this subtree could lead to service
      disruption and/or network misbehavior.</t>

      <t>Some of the readable data nodes in this YANG module may be considered
      sensitive or vulnerable in some network environments. It is thus
      important to control read access (e.g., via get, get-config, or
      notification) to these data nodes. These are the subtrees and data nodes
      and their sensitivity/vulnerability:<list style="symbols">
          <t>/nw:networks/nw:network/nw:node/sap:service-attachment-point<vspace
          blankLines="1" />Unauthorized access to this subtree can disclose
          the operational state information of the nodes in a SAP network
          model.</t>
        </list></t>

      <t></t>
    </section>

    <section anchor="Acknowledgements" title="Acknowledgements">
      <t>Thanks to Adrian Farrell and Daniel King for the suggestions on the
      name used in a previous version.</t>

      <t>Thanks to Dhruv Dhody, Benoit Claise, Bo Wu, and Erez Segev for the
      comments.</t>
    </section>
  </middle>

  <back>
    <references title="Normative References">
      <?rfc include="reference.RFC.2119"?>

      <?rfc include="reference.RFC.3688"?>

      <?rfc include="reference.RFC.6020"?>

      <?rfc include="reference.RFC.6241"?>

      <?rfc include="reference.RFC.6242"?>

      <?rfc include="reference.RFC.7950"?>

      <?rfc include="reference.RFC.8040"?>

      <?rfc include="reference.RFC.8174"?>

      <?rfc include="reference.RFC.8341"?>

      <?rfc include="reference.RFC.8345"?>

      <?rfc include="reference.RFC.8346"?>

      <?rfc include="reference.RFC.8446"?>

      <?rfc include="reference.RFC.8795"?>

      <?rfc include='reference.I-D.ietf-opsawg-vpn-common'?>
    </references>

    <references title="Informative References">
      <?rfc include="reference.RFC.7149"?>

      <?rfc include="reference.RFC.7426"?>

      <?rfc include="reference.RFC.8299"?>

      <?rfc include='reference.RFC.8466'?>

      <?rfc include="reference.RFC.8309"?>

      <?rfc include="reference.RFC.8340"?>

      <?rfc include="reference.RFC.8342"?>

      <?rfc include="reference.RFC.8343"?>

      <?rfc include='reference.I-D.ietf-opsawg-l3sm-l3nm'?>

      <?rfc include='reference.I-D.ietf-opsawg-l2nm'?>

      <?rfc include='reference.RFC.8969'?>

      <?rfc include='reference.I-D.ietf-teas-ietf-network-slices'?>

      <?rfc include='reference.I-D.ietf-teas-enhanced-vpn'?>

      <?rfc include='reference.RFC.4364'?>

      <?rfc include='reference.RFC.4761'?>

      <?rfc include='reference.RFC.4762'?>

      <?rfc include='reference.RFC.8214'?>

      <?rfc include='reference.RFC.7623'?>

      <?rfc include='reference.RFC.7432'?>

      <?rfc include='reference.RFC.8365'?>

      <?rfc include='reference.RFC.8453'?>
    </references>

    <section title="A Simple Example of SAP Network Model: Node Filter">
      <t>In the example shown in <xref target="app-ex"></xref>, PE#1 has two
      physical interfaces GE0/6/1 and GE0/6/4. Two subinterfaces GE0/6/4.1 and
      GE0/6/4.2 are associated with the physical interface GE0/6/4. Let's
      consider that four Service Attachment Points are exposed to the service
      orchestrator and mapped to these physical interfaces and
      subinterfaces.</t>

      <t><figure align="center" anchor="app-ex"
          title="An Example of PE and Associated Physical Interfaces">
          <artwork><![CDATA[   +-------------------------+
   |                 GE0/6/4 |
   | PE#1               +----+----+
   |                    |         |GE0/6/4.1
   |                    |      +--+--+
   |                    |      +--+--+
   |                    |         |GE0/6/4.2
   |                    |      +--+--+
   |                    |      +--+--+
   |                    |         |
   |                    +----+----+
   |                         |
   |                  GE0/6/1|
   |                    +----+----+
   |                    |         |
   |                    |         |
   |                    |         |
   |                    |         |
   |                    +----+----+
   |                         |
   +-------------------------+
]]></artwork>
        </figure></t>

      <t>Let us assume that for the Service Attachment Point associated with
      the first physical interface (GE0/6/1), no service is enabled yet. Also,
      let us assume that for the Service Attachment Points associated with the
      second physical interface GE0/6/4, L2VPN and L3VPN services are
      activated on the two subinterfaces GE0/6/4.1 and GE0/6/4.2,
      respectively.</t>

      <t>A service orchestrator can query what services are provided in which
      Service Attachment Points of PE#1 from the network controller by
      sending, e.g., a GET RESTCONF request. <xref
      target="app-ex-res-body"></xref> shows the body of the RESTCONF response
      that will be received from the network controller.</t>

      <t><figure anchor="app-ex-res-body">
          <artwork><![CDATA[{
  "ietf-sap-ntw:service": [
    {
      "sap-type": "l3vpn",
      "service-attachment-point": [
        {
          "attachment-id": "GE0/6/1",
          "interface-type": "ietf-sap-ntw:phy",
          "interface-role": "ietf-sap-ntw:uni",
          "description": "Ready to host SAPs",
          "status": {
            "admin-status": {
              "status": "ietf-vpn-common:admin-up"
            },
            "oper-status": {
              "status": "ietf-vpn-common:op-up"
            }
          },
          "service-status": {
            "status": "ietf-vpn-common:op-up"
          }
        },
        {
          "attachment-id": "GE0/6/4",
          "interface-type": "ietf-sap-ntw:phy",
          "interface-role": "ietf-sap-ntw:uni",
          "description": "Ready to host SAPs",
          "status": {
            "admin-status": {
              "status": "ietf-vpn-common:admin-up"
            },
            "oper-status": {
              "status": "ietf-vpn-common:op-up"
            }
          },
          "service-status": {
            "status": "ietf-vpn-common:op-up"
          }
        },
        {
          "attachment-id": "GE0/6/4.1",
          "interface-type": "ietf-sap-ntw:logical",
          "parent-termination-point": "GE0/6/4",
          "encapsulation-type": "ietf-vpn-common:vlan",
          "description": "A first SAP description",
          "status": {
            "admin-status": {
              "status": "ietf-vpn-common:admin-up"
            },
            "oper-status": {
              "status": "ietf-vpn-common:op-up"
            }
          },
          "service-status": {
            "status": "ietf-vpn-common:op-up"
          }
        }
      ]
    },
    {
      "sap-type": "l2vpn",
      "service-attachment-point": [
        {
          "attachment-id": "GE0/6/1",
          "interface-type": "ietf-sap-ntw:phy",
          "interface-role": "ietf-sap-ntw:uni",
          "description": "Ready to host SAPs",
          "status": {
            "admin-status": {
              "status": "ietf-vpn-common:admin-up"
            },
            "oper-status": {
              "status": "ietf-vpn-common:op-up"
            }
          },
          "service-status": {
            "status": "ietf-vpn-common:op-up"
          }
        },
        {
          "attachment-id": "GE0/6/4",
          "interface-type": "ietf-sap-ntw:phy",
          "interface-role": "ietf-sap-ntw:uni",
          "description": "Ready to host SAPs",
          "status": {
            "admin-status": {
              "status": "ietf-vpn-common:admin-up"
            },
            "oper-status": {
              "status": "ietf-vpn-common:op-up"
            }
          },
          "service-status": {
            "status": "ietf-vpn-common:op-up"
          }
        },
        {
          "attachment-id": "GE0/6/4.2",
          "interface-type": "ietf-sap-ntw:logical",
          "parent-termination-point": "GE0/6/4",
          "encapsulation-type": "ietf-vpn-common:vlan",
          "description": "Another description",
          "status": {
            "admin-status": {
              "status": "ietf-vpn-common:admin-up"
            },
            "oper-status": {
              "status": "ietf-vpn-common:op-up"
            }
          },
          "service-status": {
            "status": "ietf-vpn-common:op-up"
          }
        }
      ]
    }
  ]
}
]]></artwork>
        </figure></t>

      <t></t>
    </section>
  </back>
</rfc>
